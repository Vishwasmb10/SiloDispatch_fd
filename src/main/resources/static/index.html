<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Silo Dispatch Dashboard</title>
    <link rel="stylesheet" href="frontend.css" />
</head>
<body>
<div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <span class="sidebar-title">Silo Dashboard</span>
            <button class="theme-toggle" onclick="document.body.classList.toggle('dark-mode')">ðŸŒ“</button>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li><a href="#uploadForm">Upload Orders</a></li>
                <li><a href="#generateBtn">Generate Batches</a></li>
                <li><a href="#driverForm">Assign Drivers</a></li>
                <li><a href="#settleForm">Cash Settlement</a></li>
                <li><a href="#complete-form">Mark Delivery</a></li>
                <li><button class="logout-btn" onclick="logout()">ðŸšª Logout</button></li>
            </ul>
        </nav>
    </aside>

    <!-- Main dashboard content -->
    <main class="dashboard">
        <h1>Silo Dispatch Dashboard</h1>

        <!-- 1. Upload Orders CSV -->
        <section class="card card-upload">
            <h2>1. Upload Orders CSV</h2>
            <form id="uploadForm">
                <input type="file" id="csvFile" name="file" accept=".csv" required />
                <button type="submit">Upload</button>
                <div id="uploadResponse" class="response"></div>
            </form>
        </section>

        <!-- 2. Generate Batches -->
        <section class="card card-generate">
            <h2>2. Generate Batches</h2>
            <button id="generateBtn">Generate Batches</button>
            <div id="batchResponse" class="response"></div>
        </section>

        <!-- 3. Assign Batches to Drivers -->
        <section class="card card-assign">
            <h2>3. Assign Batches to Drivers</h2>
            <form id="driverForm">
                <div id="driverList" class="checkbox-group">Loading drivers...</div>
                <button type="submit">Assign Batches</button>
                <div id="assignResponse" class="response"></div>
            </form>
        </section>

        <!-- 4. Cash Settlement -->
        <section class="card card-settle">
            <h2>4. Cash Settlement</h2>
            <div id="cashList" class="cash-list">Loading driver cash info...</div>

            <form id="settleForm">
                <label for="driverSelect">Select Driver:</label>
                <select id="driverSelect" required></select>

                <label for="amountInput">Collected Amount (â‚¹):</label>
                <input type="number" id="amountInput" min="0" step="0.01" required />

                <button type="submit">Settle Cash</button>
                <div id="settleResponse" class="response"></div>
            </form>
        </section>

        <!-- 5. Mark Delivery -->
        <section class="card">
            <h2>5. Mark Delivery as Completed</h2>
            <form id="complete-form">
                <input type="number" id="driverId" placeholder="Driver ID" required>
                <button type="submit">Mark Completed</button>
            </form>
            <p id="message"></p>
        </section>
    </main>
</div>

<script>
  function logout() {
    fetch('/logout', {
      method: 'POST',
      credentials: 'include'
    })
    .then(res => {
      if (res.ok) {
        window.location.href = '/login'; // Redirect to login page
      } else {
        alert('Logout failed.');
      }
    })
    .catch(err => alert('Error logging out.'));
  }
</script>
<script src="frontend.js"></script>
</body>
</html>
